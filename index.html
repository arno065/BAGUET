<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAGUET FINDER - Localisateur de Distributeurs de Baguettes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBxpBRfQPkXlbkX7Gg660_q6ueIjA9ktFs&libraries=geometry"></script>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Open Dyslexic', Arial, sans-serif;
            background-color: #BA9B61;
        }
        @font-face {
            font-family: 'Open Dyslexic';
            src: url('https://cdn.jsdelivr.net/npm/open-dyslexic@1.0.3/open-dyslexic-regular.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }
        #app {
            display: flex;
            height: 100%;
        }
        #sidebar {
            width: 400px;
            background-color: #F5DEB3;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        #preferences {
            background-color: #FFEFD5;
            padding: 15px;
            border-radius: 15px;
            border: 2px solid #D2691E;
            margin-bottom: 20px;
        }
        #distributors-list {
            flex-grow: 1;
            overflow-y: auto;
        }
        #map-container {
            flex-grow: 1;
            position: relative;
        }
        #map {
            height: 100%;
            width: 100%;
        }
        .distributor-item {
            background-color: #FFEFD5;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 15px;
            border: 2px solid #D2691E;
        }
        .stars {
            color: #FFD700;
        }
        #contextMenu {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            padding: 5px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
        }
        #contextMenu button {
            display: block;
            width: 100%;
            padding: 5px;
            margin: 2px 0;
            background: none;
            border: none;
            text-align: left;
            cursor: pointer;
        }
        #contextMenu button:hover {
            background-color: #f0f0f0;
        }
        .favorite {
            color: gold;
            cursor: pointer;
        }
        #language-select {
            margin-bottom: 10px;
        }
        .status-available {
            color: green;
        }
        .status-unavailable {
            color: red;
        }
        .status-empty {
            color: orange;
        }
        #add-distributor-form {
            margin-bottom: 20px;
        }
        #add-distributor-form input,
        #add-distributor-form select {
            width: 100%;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="sidebar">
            <div id="preferences">
                <h2>Préférences</h2>
                <label for="language-select">Langue :</label>
                <select id="language-select">
                    <option value="fr">Français</option>
                    <option value="en">English</option>
                </select>
                <h3>Favoris</h3>
                <ul id="favorites-list"></ul>
                <h3>Historique de recherche</h3>
                <ul id="search-history"></ul>
                <h3>Points de fidélité</h3>
                <p>Vos points : <span id="loyalty-points">0</span></p>
            </div>
            <div id="add-distributor-form">
                <h3>Ajouter un nouveau distributeur</h3>
                <form id="new-distributor-form">
                    <input type="text" id="new-name" placeholder="Nom" required>
                    <input type="text" id="new-address" placeholder="Adresse" required>
                    <input type="number" id="new-price" step="0.01" placeholder="Prix" required>
                    <select id="new-payment" multiple required>
                        <option value="cash">Espèces</option>
                        <option value="card">Carte</option>
                    </select>
                    <button type="submit">Soumettre pour modération</button>
                </form>
            </div>
            <div id="distributors-list"></div>
        </div>
        <div id="map-container">
            <div id="map"></div>
        </div>
    </div>
    <div id="contextMenu">
        <button id="centerMapBtn">Centrer la carte ici</button>
        <button id="addDistributorBtn">Ajouter un distributeur ici</button>
        <button id="findNearestBtn">Trouver le distributeur le plus proche</button>
    </div>

    <script>
        // Données statiques des distributeurs
        let distributors = [
            { id: 1, name: "Distributeur Boulangerie Paul", lat: 48.8584, lng: 2.2945, address: "123 Rue de Paris", price: 1.20, rating: 4, payment: ["cash", "card"], reviews: [], status: "available" },
            { id: 2, name: "Distri-Baguette Express", lat: 48.8738, lng: 2.2950, address: "45 Avenue des Champs-Élysées", price: 1.10, rating: 3, payment: ["cash"], reviews: [], status: "unavailable" },
            { id: 3, name: "Le Petit Boulanger Automatique", lat: 48.8600, lng: 2.3400, address: "78 Boulevard Saint-Michel", price: 1.30, rating: 5, payment: ["card"], reviews: [], status: "empty" },
        ];

        let favorites = [];
        let searchHistory = [];
        let loyaltyPoints = 0;
        let currentLanguage = 'fr';
        let map;
        let markers = [];

        const translations = {
            fr: {
                addReview: "Ajouter un avis",
                seeReviews: "Voir les avis",
                favorite: "Favori",
                viewOnMap: "Voir sur la carte",
                nearestDistributor: "Le distributeur le plus proche est",
                meters: "mètres",
                invalidInput: "Entrée invalide. Veuillez réessayer.",
                loyaltyPoints: "Points de fidélité",
                language: "Langue",
                favorites: "Favoris",
                searchHistory: "Historique de recherche",
                available: "Disponible",
                unavailable: "En panne",
                empty: "Vide",
                openInGoogleMaps: "Ouvrir dans Google Maps"
            },
            en: {
                addReview: "Add review",
                seeReviews: "See reviews",
                favorite: "Favorite",
                viewOnMap: "View on map",
                nearestDistributor: "The nearest distributor is",
                meters: "meters",
                invalidInput: "Invalid input. Please try again.",
                loyaltyPoints: "Loyalty points",
                language: "Language",
                favorites: "Favorites",
                searchHistory: "Search history",
                available: "Available",
                unavailable: "Out of order",
                empty: "Empty",
                openInGoogleMaps: "Open in Google Maps"
            }
        };

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 48.8566, lng: 2.3522 },
                zoom: 12
            });

            distributors.forEach(addMarker);

            map.addListener('rightclick', function(e) {
                showContextMenu(e.latLng);
            });
        }

        function addMarker(distributor) {
            const marker = new google.maps.Marker({
                position: { lat: distributor.lat, lng: distributor.lng },
                map: map,
                title: distributor.name
            });

            const infoWindow = new google.maps.InfoWindow({
                content: getDistributorContent(distributor)
            });

            marker.addListener('click', function() {
                infoWindow.open(map, marker);
            });

            markers.push(marker);
        }

        function getDistributorContent(distributor) {
            return `
                <b>${distributor.name}</b><br>
                ${distributor.address}<br>
                Prix : ${distributor.price.toFixed(2)}€<br>
                Note : ${getStars(distributor.rating)}<br>
                Paiement : ${getPaymentIcons(distributor.payment)}<br>
                Statut : ${getStatusIcon(distributor.status)}<br>
                <button onclick="addReview(${distributor.id})">${translate('addReview')}</button>
                <button onclick="seeReviews(${distributor.id})">${translate('seeReviews')}</button>
                <a href="https://www.google.com/maps/search/?api=1&query=${distributor.lat},${distributor.lng}" target="_blank">${translate('openInGoogleMaps')}</a>
            `;
        }

        function getStars(rating) {
            return '<span class="stars">' + '★'.repeat(rating) + '☆'.repeat(5-rating) + '</span>';
        }

        function getPaymentIcons(payment) {
            const icons = {
                cash: '<i class="fas fa-money-bill-alt" title="Espèces"></i>',
                card: '<i class="fas fa-credit-card" title="Carte"></i>'
            };
            return payment.map(p => icons[p]).join(' ');
        }

        function getStatusIcon(status) {
            const statusIcons = {
                available: '<span class="status-available"><i class="fas fa-check-circle"></i> ' + translate('available') + '</span>',
                unavailable: '<span class="status-unavailable"><i class="fas fa-times-circle"></i> ' + translate('unavailable') + '</span>',
                empty: '<span class="status-empty"><i class="fas fa-exclamation-circle"></i> ' + translate('empty') + '</span>'
            };
            return statusIcons[status] || '';
        }

        function displayList() {
            const listElement = document.getElementById('distributors-list');
            listElement.innerHTML = '';
            distributors.forEach(distributor => {
                const item = document.createElement('div');
                item.className = 'distributor-item';
                item.innerHTML = `
                    <h3>${distributor.name} 
                        <i class="fas fa-star favorite" onclick="toggleFavorite(${distributor.id})" 
                           style="color: ${favorites.includes(distributor.id) ? 'gold' : 'grey'}"></i>
                    </h3>
                    <p>${distributor.address}</p>
                    <p>Prix : ${distributor.price.toFixed(2)}€</p>
                    <p>Note : ${getStars(distributor.rating)}</p>
                    <p>Paiement : ${getPaymentIcons(distributor.payment)}</p>
                    <p>Statut : ${getStatusIcon(distributor.status)}</p>
                    <button onclick="centerMap(${distributor.lat}, ${distributor.lng})">${translate('viewOnMap')}</button>
                    <button onclick="addReview(${distributor.id})">${translate('addReview')}</button>
                    <button onclick="seeReviews(${distributor.id})">${translate('seeReviews')}</button>
                    <a href="https://www.google.com/maps/search/?api=1&query=${distributor.lat},${distributor.lng}" target="_blank">${translate('openInGoogleMaps')}</a>
                `;
                listElement.appendChild(item);
            });
        }

        function centerMap(lat, lng) {
            map.setCenter({ lat: lat, lng: lng });
            map.setZoom(16);
        }

        function showContextMenu(latLng) {
            const contextMenu = document.getElementById('contextMenu');
            contextMenu.style.display = 'block';
            contextMenu.style.left = event.clientX + 'px';
            contextMenu.style.top = event.clientY + 'px';

            document.getElementById('centerMapBtn').onclick = function() {
                map.setCenter(latLng);
                hideContextMenu();
            };

            document.getElementById('addDistributorBtn').onclick = function() {
                const name = prompt("Nom du nouveau distributeur :");
                const address = prompt("Adresse du nouveau distributeur :");
                const price = parseFloat(prompt("Prix de la baguette :"));
                const rating = parseInt(prompt("Note (de 1 à 5) :"));
                const paymentMethods = prompt("Méthodes de paiement (cash, card ou les deux séparés par une virgule) :").split(',').map(m => m.trim());
                const status = prompt("Statut (available, unavailable, empty) :");
                
                if (name && address && !isNaN(price) && !isNaN(rating) && paymentMethods.length > 0 && status) {
                    const newDistributor = {
                        id: distributors.length + 1,
                        name: name,
                        lat: latLng.lat(),
                        lng: latLng.lng(),
                        address: address,
                        price: price,
                        rating: rating,
                        payment: paymentMethods,
                        reviews: [],
                        status: status
                    };
                    distributors.push(newDistributor);
                    addMarker(newDistributor);
                    displayList();
                } else {
                    alert(translate('invalidInput'));
                }
                hideContextMenu();
            };

            document.getElementById('findNearestBtn').onclick = function() {
            let nearest = null;
            let minDistance = Infinity;
            distributors.forEach(distributor => {
                const distance = google.maps.geometry.spherical.computeDistanceBetween(
                    latLng,
                    new google.maps.LatLng(distributor.lat, distributor.lng)
                );
                if (distance < minDistance) {
                    minDistance = distance;
                    nearest = distributor;
                }
            });
            if (nearest) {
                alert(`${translate('nearestDistributor')} "${nearest.name}" à ${Math.round(minDistance)} ${translate('meters')}.`);
                centerMap(nearest.lat, nearest.lng);
                addToSearchHistory(nearest.name);
            }
            hideContextMenu();
        };

        function hideContextMenu() {
            document.getElementById('contextMenu').style.display = 'none';
        }

        function toggleFavorite(id) {
            const index = favorites.indexOf(id);
            if (index > -1) {
                favorites.splice(index, 1);
            } else {
                favorites.push(id);
                loyaltyPoints += 10;
                updateLoyaltyPoints();
            }
            displayList();
            updateFavoritesList();
        }

        function updateFavoritesList() {
            const favoritesList = document.getElementById('favorites-list');
            favoritesList.innerHTML = '';
            favorites.forEach(id => {
                const distributor = distributors.find(d => d.id === id);
                if (distributor) {
                    const li = document.createElement('li');
                    li.textContent = distributor.name;
                    favoritesList.appendChild(li);
                }
            });
        }

        function addToSearchHistory(name) {
            searchHistory.unshift(name);
            if (searchHistory.length > 5) {
                searchHistory.pop();
            }
            updateSearchHistory();
        }

        function updateSearchHistory() {
            const historyList = document.getElementById('search-history');
            historyList.innerHTML = '';
            searchHistory.forEach(name => {
                const li = document.createElement('li');
                li.textContent = name;
                historyList.appendChild(li);
            });
        }

        function updateLoyaltyPoints() {
            document.getElementById('loyalty-points').textContent = loyaltyPoints;
        }

        function addReview(id) {
            const review = prompt("Ajoutez votre avis :");
            if (review) {
                const distributor = distributors.find(d => d.id === id);
                distributor.reviews.push(review);
                loyaltyPoints += 5;
                updateLoyaltyPoints();
            }
        }

        function seeReviews(id) {
            const distributor = distributors.find(d => d.id === id);
            if (distributor.reviews.length > 0) {
                alert(distributor.reviews.join('\n\n'));
            } else {
                alert("Aucun avis pour le moment.");
            }
        }

        document.getElementById('language-select').addEventListener('change', function(e) {
            currentLanguage = e.target.value;
            updateLanguage();
        });

        function updateLanguage() {
            document.querySelector('label[for="language-select"]').textContent = translate('language') + ' :';
            document.querySelector('#preferences h3:nth-of-type(1)').textContent = translate('favorites');
            document.querySelector('#preferences h3:nth-of-type(2)').textContent = translate('searchHistory');
            document.querySelector('#preferences h3:nth-of-type(3)').textContent = translate('loyaltyPoints');
            document.getElementById('centerMapBtn').textContent = translate('centerMapBtn');
            document.getElementById('addDistributorBtn').textContent = translate('addDistributorBtn');
            document.getElementById('findNearestBtn').textContent = translate('findNearestBtn');
            displayList();
            updateFavoritesList();
            updateSearchHistory();
        }

        function translate(key) {
            return translations[currentLanguage][key] || key;
        }

        document.getElementById("new-distributor-form").addEventListener("submit", function(e) {
            e.preventDefault();
            const name = document.getElementById("new-name").value;
            const address = document.getElementById("new-address").value;
            const price = parseFloat(document.getElementById("new-price").value);
            const payment = Array.from(document.getElementById("new-payment").selectedOptions).map(option => option.value);

            // Ici, vous pourriez envoyer ces données à un serveur pour modération
            alert("Merci pour votre suggestion. Elle sera examinée par nos modérateurs.");

            // Réinitialiser le formulaire
            this.reset();
        });

        // Ajout de distributeurs de baguettes en Mayenne
        const mayenneDistributors = [
            { id: 4, name: "Baguet'Express Laval", lat: 48.0706, lng: -0.7724, address: "22 Rue de la Paix, 53000 Laval", price: 1.10, rating: 4, payment: ["cash", "card"], reviews: [], status: "available" },
            { id: 5, name: "Le Fournil Automatique", lat: 48.1181, lng: -0.7107, address: "5 Place du Marché, 53100 Mayenne", price: 1.00, rating: 3, payment: ["cash"], reviews: [], status: "available" },
            { id: 6, name: "Distri-Pain Château-Gontier", lat: 47.8284, lng: -0.7064, address: "10 Avenue Carnot, 53200 Château-Gontier", price: 1.20, rating: 4, payment: ["card"], reviews: [], status: "available" },
            { id: 7, name: "Baguettes 24/7 Evron", lat: 48.1558, lng: -0.4039, address: "2 Place de la Basilique, 53600 Evron", price: 1.15, rating: 5, payment: ["cash", "card"], reviews: [], status: "available" },
            { id: 8, name: "La Mie Matinale", lat: 48.3047, lng: -0.6174, address: "8 Rue du Pont, 53300 Ambrières-les-Vallées", price: 1.05, rating: 4, payment: ["cash"], reviews: [], status: "available" },
            { id: 9, name: "Pain Chaud Automatique", lat: 48.2731, lng: -0.3681, address: "15 Grande Rue, 53110 Lassay-les-Châteaux", price: 1.10, rating: 3, payment: ["card"], reviews: [], status: "unavailable" },
            { id: 10, name: "Croustillant Express", lat: 47.9117, lng: -0.9414, address: "3 Place Hercé, 53500 Ernée", price: 1.20, rating: 4, payment: ["cash", "card"], reviews: [], status: "available" },
            { id: 11, name: "Le Petit Boulanger", lat: 48.4506, lng: -0.5608, address: "7 Rue du Maine, 53140 Pré-en-Pail-Saint-Samson", price: 1.00, rating: 5, payment: ["cash"], reviews: [], status: "empty" },
            { id: 12, name: "Baguette Fraîche 53", lat: 47.9667, lng: -0.8833, address: "20 Rue Nationale, 53410 Le Bourgneuf-la-Forêt", price: 1.15, rating: 4, payment: ["card"], reviews: [], status: "available" },
            { id: 13, name: "La Mie Dorée", lat: 48.3047, lng: -0.9897, address: "1 Place de l'Église, 53120 Gorron", price: 1.10, rating: 3, payment: ["cash", "card"], reviews: [], status: "available" }
        ];

        // Ajout des nouveaux distributeurs à la liste existante
        distributors = distributors.concat(mayenneDistributors);

        // Initialisation
        function init() {
            initMap();
            displayList();
            updateFavoritesList();
            updateSearchHistory();
            updateLoyaltyPoints();
            updateLanguage();
        }

        init();
    </script>
</body>
</html>
