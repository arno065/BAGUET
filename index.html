<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAGUET FINDER - Localisateur de Distributeurs de Baguettes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Open Dyslexic', Arial, sans-serif;
            background-color: #D3B12A; /* Couleur de fond inspirée de la baguette */
        }

        @font-face {
            font-family: 'Open Dyslexic';
            src: url('https://cdn.jsdelivr.net/npm/open-dyslexic@1.0.3/open-dyslexic-regular.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        #app {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        #sidebar {
            width: 100%;
            max-width: 400px; /* Limiter la largeur sur les grands écrans */
            background-color: #F5DEB3; /* Couleur crème pour évoquer la baguette */
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 2px 15px rgba(0, 0, 0, 0.3);
        }

        #preferences {
            background-color: #FFEFD5; /* Couleur douce */
            padding: 15px;
            border-radius: 15px;
            border: 2px solid #D2691E; /* Marron clair */
            margin-bottom: 20px;
        }

        #distributors-list {
            flex-grow: 1;
            overflow-y: auto;
        }

        #map-container {
            flex-grow: 1;
            position: relative;
        }

        #map {
            height: 100%;
            width: 100%;
        }

        .distributor-item {
            background-color: #FFEFD5; /* Couleur douce pour chaque distributeur */
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 15px;
            border: 2px solid #D2691E;
            transition: transform 0.2s;
        }

        .distributor-item:hover {
            transform: scale(1.02); /* Effet d'agrandissement au survol */
        }

        .stars {
            color: #FFD700; /* Couleur des étoiles */
        }

        .favorite {
            color: gold;
            cursor: pointer;
        }

        #language-select {
            margin-bottom: 10px;
        }

        .status-available {
            color: green;
        }

        .status-unavailable {
            color: red;
        }

        .status-empty {
            color: orange;
        }

        #add-distributor-form input,
        #add-distributor-form select {
            width: 100%;
            margin-bottom: 10px;
        }

        /* Media queries for responsive design */
        @media (max-width: 768px) {
            #app {
                flex-direction: column; /* Stack sidebar and map on smaller screens */
            }

            #sidebar {
                max-width: 100%; /* Take full width on mobile */
            }

            #map-container {
                height: 400px; /* Fixed height for map on mobile */
            }
        }

        @media (max-width: 480px) {
            #sidebar {
                padding: 10px; /* Reduce padding on mobile */
            }

            .distributor-item {
                padding: 10px; /* Reduce padding for items */
            }

            #add-distributor-form input,
            #add-distributor-form select {
                font-size: 14px; /* Adjust font size for input fields */
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="sidebar">
            <div id="preferences">
                <h2>Préférences</h2>
                <label for="language-select">Langue :</label>
                <select id="language-select">
                    <option value="fr">Français</option>
                    <option value="en">English</option>
                </select>
                <h3>Favoris</h3>
                <ul id="favorites-list"></ul>
                <h3>Historique de recherche</h3>
                <ul id="search-history"></ul>
                <h3>Points de fidélité</h3>
                <p>Vos points : <span id="loyalty-points">0</span></p>
            </div>
            <div id="add-distributor-form">
                <h3>Ajouter un nouveau distributeur</h3>
                <form id="new-distributor-form">
                    <input type="text" id="new-name" placeholder="Nom" required>
                    <input type="text" id="new-address" placeholder="Adresse" required>
                    <input type="number" id="new-price" step="0.01" placeholder="Prix" required>
                    <select id="new-payment" multiple required>
                        <option value="cash">Espèces</option>
                        <option value="card">Carte</option>
                    </select>
                    <input type="text" id="new-photo" placeholder="URL de la photo" required>
                    <button type="submit">Soumettre pour modération</button>
                </form>
            </div>
            <div id="distributors-list"></div>
        </div>
        <div id="map-container">
            <div id="map"></div>
        </div>
    </div>

    <script>
        // Les données des distributeurs avec des photos
        let distributors = [
            { id: 1, name: "Distributeur Boulangerie Paul", lat: 48.8584, lng: 2.2945, address: "123 Rue de Paris", price: 1.20, rating: 4, payment: ["cash", "card"], reviews: [], status: "available", photo: "https://via.placeholder.com/150" },
            { id: 2, name: "Distri-Baguette Express", lat: 48.8738, lng: 2.2950, address: "45 Avenue des Champs-Élysées", price: 1.10, rating: 3, payment: ["cash"], reviews: [], status: "unavailable", photo: "https://via.placeholder.com/150" },
            { id: 3, name: "Le Petit Boulanger Automatique", lat: 48.8600, lng: 2.3400, address: "78 Boulevard Saint-Michel", price: 1.30, rating: 5, payment: ["card"], reviews: [], status: "empty", photo: "https://via.placeholder.com/150" },
            { id: 4, name: "Baguette d'Or", lat: 48.8566, lng: 2.3522, address: "5 Rue de Rivoli", price: 1.50, rating: 4, payment: ["cash"], reviews: [], status: "available", photo: "https://via.placeholder.com/150" },
            { id: 5, name: "Boulangerie des Champs", lat: 48.8700, lng: 2.3300, address: "10 Rue des Filles du Calvaire", price: 1.00, rating: 5, payment: ["card"], reviews: [], status: "available", photo: "https://via.placeholder.com/150" }
        ];

        let favorites = [];
        let searchHistory = [];
        let loyaltyPoints = 0;
        let currentLanguage = 'fr';
        let map;
        let markers = [];

        const translations = {
            fr: {
                addReview: "Ajouter un avis",
                seeReviews: "Voir les avis",
                favorite: "Favori",
                viewOnMap: "Voir sur la carte",
                nearestDistributor: "Le distributeur le plus proche est",
                meters: "mètres",
                invalidInput: "Entrée invalide. Veuillez réessayer.",
                loyaltyPoints: "Points de fidélité",
                language: "Langue",
                favorites: "Favoris",
                searchHistory: "Historique de recherche",
                available: "Disponible",
                unavailable: "En panne",
                empty: "Vide",
                openInGoogleMaps: "Ouvrir dans Google Maps"
            },
            en: {
                addReview: "Add a review",
                seeReviews: "See reviews",
                favorite: "Favorite",
                viewOnMap: "View on map",
                nearestDistributor: "The nearest distributor is",
                meters: "meters",
                invalidInput: "Invalid input. Please try again.",
                loyaltyPoints: "Loyalty points",
                language: "Language",
                favorites: "Favorites",
                searchHistory: "Search history",
                available: "Available",
                unavailable: "Unavailable",
                empty: "Empty",
                openInGoogleMaps: "Open in Google Maps"
            }
        };

        function initializeMap() {
            map = L.map('map').setView([48.8566, 2.3522], 12); // View centered on Paris

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '© OpenStreetMap'
            }).addTo(map);

            distributors.forEach(distributor => {
                const marker = L.marker([distributor.lat, distributor.lng]).addTo(map);
                markers.push(marker);

                marker.on('click', () => {
                    displayDistributorDetails(distributor);
                });
            });
        }

        function displayDistributorDetails(distributor) {
            const distributorItem = document.createElement('div');
            distributorItem.className = 'distributor-item';
            distributorItem.innerHTML = `
                <h4>${distributor.name}</h4>
                <p>${distributor.address}</p>
                <p>Prix: ${distributor.price} €</p>
                <p class="stars">${'★'.repeat(distributor.rating)}${'☆'.repeat(5 - distributor.rating)}</p>
                <p>Status: <span class="${distributor.status === 'available' ? 'status-available' : distributor.status === 'unavailable' ? 'status-unavailable' : 'status-empty'}">${translations[currentLanguage][distributor.status]}</span></p>
                <button class="favorite" onclick="toggleFavorite(${distributor.id})">${translations[currentLanguage].favorite}</button>
                <button onclick="openInGoogleMaps(${distributor.lat}, ${distributor.lng})">${translations[currentLanguage].openInGoogleMaps}</button>
                <button onclick="showReviews(${distributor.id})">${translations[currentLanguage].seeReviews}</button>
            `;
            document.getElementById('distributors-list').appendChild(distributorItem);
        }

        function toggleFavorite(id) {
            const index = favorites.indexOf(id);
            if (index === -1) {
                favorites.push(id);
            } else {
                favorites.splice(index, 1);
            }
            updateFavoritesList();
        }

        function updateFavoritesList() {
            const favoritesList = document.getElementById('favorites-list');
            favoritesList.innerHTML = '';
            favorites.forEach(id => {
                const distributor = distributors.find(d => d.id === id);
                const item = document.createElement('li');
                item.innerText = distributor.name;
                favoritesList.appendChild(item);
            });
        }

        function openInGoogleMaps(lat, lng) {
            const url = `https://www.google.com/maps/@${lat},${lng},15z`;
            window.open(url, '_blank');
        }

        function showReviews(id) {
            const distributor = distributors.find(d => d.id === id);
            const reviewText = prompt(translations[currentLanguage].addReview);
            if (reviewText) {
                distributor.reviews.push(reviewText);
                alert('Review added!');
            } else {
                alert(translations[currentLanguage].invalidInput);
            }
        }

        function addDistributor(event) {
            event.preventDefault();
            const newDistributor = {
                id: distributors.length + 1,
                name: document.getElementById('new-name').value,
                address: document.getElementById('new-address').value,
                price: parseFloat(document.getElementById('new-price').value),
                rating: 3, // Default rating
                payment: Array.from(document.getElementById('new-payment').selectedOptions).map(option => option.value),
                reviews: [],
                status: "available",
                photo: document.getElementById('new-photo').value,
                lat: 48.8566, // Default lat, should be updated with geocoding
                lng: 2.3522  // Default lng, should be updated with geocoding
            };

            distributors.push(newDistributor);
            alert('Distributor submitted for moderation.');
            document.getElementById('new-distributor-form').reset();
            initializeMap();
        }

        document.getElementById('new-distributor-form').addEventListener('submit', addDistributor);
        document.getElementById('language-select').addEventListener('change', function () {
            currentLanguage = this.value;
            updateTranslations();
        });

        function updateTranslations() {
            // Update all translatable texts based on the selected language
            document.getElementById('preferences').querySelector('h2').innerText = translations[currentLanguage].preferences;
            document.getElementById('add-distributor-form').querySelector('h3').innerText = translations[currentLanguage].addDistributor;
            // Add more translations for each element as needed
            updateFavoritesList(); // Update favorites display
        }

        window.onload = initializeMap;
    </script>
</body>
</html>
