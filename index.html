<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Localisateur de Distributeurs de Baguettes</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        #map {
            height: 60%;
            width: 100%;
        }
        #list {
            height: 40%;
            overflow-y: auto;
            padding: 10px;
        }
        .distributor-item {
            background-color: #f0f0f0;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 5px;
        }
        .stars {
            color: #FFD700;
        }
        #contextMenu {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            padding: 5px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
        }
        #contextMenu button {
            display: block;
            width: 100%;
            padding: 5px;
            margin: 2px 0;
            background: none;
            border: none;
            text-align: left;
            cursor: pointer;
        }
        #contextMenu button:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="list"></div>
    <div id="contextMenu">
        <button id="centerMapBtn">Centrer la carte ici</button>
        <button id="addDistributorBtn">Ajouter un distributeur ici</button>
        <button id="findNearestBtn">Trouver le distributeur le plus proche</button>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // Données statiques des distributeurs
        const distributors = [
            { id: 1, name: "Distributeur Boulangerie Paul", lat: 48.8584, lng: 2.2945, address: "123 Rue de Paris", price: 1.20, rating: 4, payment: ["cash", "card"] },
            { id: 2, name: "Distri-Baguette Express", lat: 48.8738, lng: 2.2950, address: "45 Avenue des Champs-Élysées", price: 1.10, rating: 3, payment: ["cash"] },
            { id: 3, name: "Le Petit Boulanger Automatique", lat: 48.8600, lng: 2.3400, address: "78 Boulevard Saint-Michel", price: 1.30, rating: 5, payment: ["card"] },
        ];

        // Initialisation de la carte
        const map = L.map('map').setView([48.8566, 2.3522], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Fonction pour ajouter un marqueur
        function addMarker(distributor) {
            const marker = L.marker([distributor.lat, distributor.lng]).addTo(map);
            marker.bindPopup(`
                <b>${distributor.name}</b><br>
                ${distributor.address}<br>
                Prix : ${distributor.price.toFixed(2)}€<br>
                Note : ${getStars(distributor.rating)}<br>
                Paiement : ${getPaymentIcons(distributor.payment)}
            `);
        }

        // Fonction pour afficher les étoiles de notation
        function getStars(rating) {
            return '<span class="stars">' + '★'.repeat(rating) + '☆'.repeat(5-rating) + '</span>';
        }

        // Fonction pour afficher les icônes de paiement
        function getPaymentIcons(payment) {
            const icons = {
                cash: '<i class="fas fa-money-bill-alt" title="Espèces"></i>',
                card: '<i class="fas fa-credit-card" title="Carte"></i>'
            };
            return payment.map(p => icons[p]).join(' ');
        }

        // Fonction pour afficher la liste des distributeurs
        function displayList() {
            const listElement = document.getElementById('list');
            listElement.innerHTML = ''; // Clear existing list
            distributors.forEach(distributor => {
                const item = document.createElement('div');
                item.className = 'distributor-item';
                item.innerHTML = `
                    <h3>${distributor.name}</h3>
                    <p>${distributor.address}</p>
                    <p>Prix : ${distributor.price.toFixed(2)}€</p>
                    <p>Note : ${getStars(distributor.rating)}</p>
                    <p>Paiement : ${getPaymentIcons(distributor.payment)}</p>
                    <button onclick="centerMap(${distributor.lat}, ${distributor.lng})">Voir sur la carte</button>
                `;
                listElement.appendChild(item);
            });
        }

        // Fonction pour centrer la carte sur un distributeur
        function centerMap(lat, lng) {
            map.setView([lat, lng], 16);
        }

        // Gestion du menu contextuel
        let contextMenuLatLng;

        map.on('contextmenu', function(e) {
            contextMenuLatLng = e.latlng;
            const contextMenu = document.getElementById('contextMenu');
            contextMenu.style.display = 'block';
            contextMenu.style.left = e.originalEvent.pageX + 'px';
            contextMenu.style.top = e.originalEvent.pageY + 'px';
        });

        document.getElementById('centerMapBtn').addEventListener('click', function() {
            map.setView(contextMenuLatLng, map.getZoom());
            hideContextMenu();
        });

        document.getElementById('addDistributorBtn').addEventListener('click', function() {
            const name = prompt("Nom du nouveau distributeur :");
            const address = prompt("Adresse du nouveau distributeur :");
            const price = parseFloat(prompt("Prix de la baguette :"));
            const rating = parseInt(prompt("Note (de 1 à 5) :"));
            const paymentMethods = prompt("Méthodes de paiement (cash, card ou les deux séparés par une virgule) :").split(',').map(m => m.trim());
            
            if (name && address && !isNaN(price) && !isNaN(rating) && paymentMethods.length > 0) {
                const newDistributor = {
                    id: distributors.length + 1,
                    name: name,
                    lat: contextMenuLatLng.lat,
                    lng: contextMenuLatLng.lng,
                    address: address,
                    price: price,
                    rating: rating,
                    payment: paymentMethods
                };
                distributors.push(newDistributor);
                addMarker(newDistributor);
                displayList();
            }
            hideContextMenu();
        });

        document.getElementById('findNearestBtn').addEventListener('click', function() {
            let nearest = null;
            let minDistance = Infinity;
            distributors.forEach(distributor => {
                const distance = map.distance(contextMenuLatLng, [distributor.lat, distributor.lng]);
                if (distance < minDistance) {
                    minDistance = distance;
                    nearest = distributor;
                }
            });
            if (nearest) {
                alert(`Le distributeur le plus proche est "${nearest.name}" à ${Math.round(minDistance)} mètres.`);
                centerMap(nearest.lat, nearest.lng);
            }
            hideContextMenu();
        });

        function hideContextMenu() {
            document.getElementById('contextMenu').style.display = 'none';
        }

        // Fermer le menu contextuel en cliquant ailleurs sur la carte
        map.on('click', hideContextMenu);

        // Initialisation
        distributors.forEach(addMarker);
        displayList();
    </script>
</body>
</html>
